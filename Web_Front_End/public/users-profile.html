<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Users / Profile</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="vendor/simple-datatables/style.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="css/style.css" rel="stylesheet">
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-between">
      <a href="dashboard.html" class="logo d-flex align-items-center">
        <img src="img/logo.png" alt="">
        <span class="d-none d-lg-block">Monitoring systems</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->

    <div class="search-bar">
      <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword">
        <button type="submit" title="Search"><i class="bi bi-search"></i></button>
      </form>
    </div><!-- End Search Bar -->

    <nav class="header-nav ms-auto">
      <ul class="d-flex align-items-center">

        <li class="nav-item d-block d-lg-none">
          <a class="nav-link nav-icon search-bar-toggle " href="#">
            <i class="bi bi-search"></i>
          </a>
        </li><!-- End Search Icon-->

        <li class="nav-item dropdown">

          <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown">
            <i class="bi bi-bell"></i>
            <span class="badge bg-primary badge-number">4</span>
          </a><!-- End Notification Icon -->

          <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow notifications">
           
            <li>
              <hr class="dropdown-divider">
            </li>
            <li class="dropdown-footer">
              <a href="#">Show all notifications</a>
            </li>

          </ul><!-- End Notification Dropdown Items -->

        </li><!-- End Notification Nav -->

        <li class="nav-item dropdown pe-3">

          <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
            <img src="img/profile-img.png" alt="Profile" class="rounded-circle">
            <span class="d-none d-md-block dropdown-toggle ps-2">Admin</span>
          </a><!-- End Profile Iamge Icon -->

          <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
            <li class="dropdown-header">
              <h6>ID: 1243432</h6>
              <span>The owner</span>
            </li>
            <li>
              <hr class="dropdown-divider">
            </li>
            <li>
              <a class="dropdown-item d-flex align-items-center" href="Profile">
                <i class="bi bi-person"></i>
                <span>My Profile</span>
              </a>
            </li>
            <li>
              <a class="dropdown-item d-flex align-items-center" href="logout">
                <i class="bi bi-box-arrow-right"></i>
                <span>Sign Out</span>
              </a>
            </li>

          </ul><!-- End Profile Dropdown Items -->
        </li><!-- End Profile Nav -->

      </ul>
    </nav><!-- End Icons Navigation -->

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-item">
        <a class="nav-link collapsed" href="Dashboard">
          <i class="bi bi-grid"></i>
          <span>Dashboard</span>
        </a>
      </li><!-- End Dashboard Nav -->


      <li class="nav-heading">Pages</li>
      <li class="nav-item">
        <a class="nav-link " href="Profile">
          <i class="bi bi-person"></i>
          <span>Profile</span>
        </a>
      </li><!-- End Profile Page Nav -->
    </ul>

  </aside><!-- End Sidebar-->

  <main id="main" class="main">

    <div class="pagetitle">
      <h1>Profile</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="dashboard.html">Home</a></li>
          <li class="breadcrumb-item">Users</li>
          <li class="breadcrumb-item active">Profile</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section profile">
      <div class="row">
        <div class="col-xl-4">

          <div class="card">
            <div class="card-body profile-card pt-4 d-flex flex-column align-items-center">

              <img src="img/profile-img.png" alt="Profile" class="rounded-circle">
              <h2>Admin</h2>
              <h3>The owner</h3>
              <div class="social-links mt-2">
                <a href="#" class="twitter"><i class="bi bi-twitter"></i></a>
                <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
                <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
                <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
              </div>
            </div>
          </div>

          <!-- Email notify setting -->
          <section class="demo-container">
            <h1>Email notification: </h1>
            <div class="kitty-switch">
              <input type="checkbox" id="toggle" tabindex="1">
              <div class="kitty"></div>
              <label for="toggle" class="well"></label>
              <span class="prompt">Do you want to receive <br> warning notifications? </span>

              <div class="visible">
                <p>Enter your email!</p>
                <input type="email" id="email-noti" name="email" class="email-input">
                <button type="submit" id="btnSubmitEmail" class="confirm-button">Confirm</button>
              </div>
            </div>
            <script type="module">
              import { getCookie } from "/js/cookieHandle.js";
              import { getUser, setUserSendEmail } from "/js/firebaseConfig.js"
              document.addEventListener("DOMContentLoaded", async function () {
                // Lấy phần tử toggle
                const user = await getUser();
                console.log(user);
                var toggle = document.getElementById("toggle");

                // Lấy phần tử visible
                var visible = document.querySelector(".visible");
                // Lấy phẩn tử email noti
                var emailNoti = document.querySelector("#email-noti");
                // Lấy phần tử confirm button
                var confirmButton = document.querySelector("#btnSubmitEmail");
                if(user.sendMail){
                  toggle.checked = true;
                  emailNoti.value = user.email;
                  visible.classList.remove("hidden");
                }
                // Thêm sự kiện click cho nút Confirm
                confirmButton.addEventListener("click", async function () {
                  const email = document.getElementById('email-noti').value;
                  const user_id = getCookie('user_id');
                  const response = await fetch('/email-noti', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, user_id })
                  });
                  visible.classList.add("hidden");

                });

                // Thêm sự kiện change cho toggle
                toggle.addEventListener("change", async function () {
                  if (toggle.checked) {
                    visible.classList.remove("hidden");
                    if(user.email)
                      emailNoti.value = user.email;
                    if(user.email){
                      await setUserSendEmail(true);
                    }
                  } else {
                    visible.classList.add("hidden");
                    await setUserSendEmail(false);
                  }
                });
              });
              
            </script>
          </section>
          <!--End Email notify setting -->
        </div>
        <div class="col-xl-8">
          <div class="card">
            <div class="card-body pt-3">
              <!-- Bordered Tabs -->
              <ul class="nav nav-tabs nav-tabs-bordered">

                <li class="nav-item">
                  <button class="nav-link active" data-bs-toggle="tab"
                    data-bs-target="#profile-overview">Overview</button>
                </li>
              </ul>
              <div class="tab-content pt-2">
                <div class="tab-pane fade show active profile-overview" id="profile-overview">
                  <h5 class="card-title">About</h5>
                  <p class="small fst-italic">
                    People are increasingly realizing how important it is to keep our environment clean and healthy. They want stricter measures to protect and improve where they live. That's why setting up systems to monitor the environment is so important<br>
                    Thanks to new technology like smart sensors and networks, we now have better ways to monitor the environment. These systems keep track of environmental quality all the time. The data they collect can help governments, groups outside the government, and local communities make decisions about how to take care of the environment and keep people healthy.
                  </p>
                  <img src="img/abc.png" alt="Description of the image" style="max-width: 800px; max-height: 260px;">
                </div>
                </div>
              </div><!-- End Bordered Tabs -->
            </div>
          </div>
        </div>
      </div>
    </section>

  </main><!-- End #main -->
  <!-- Template Main JS File -->
  <script type="module" src="js/main.js"></script>

</body>

</html>